Application Notes (up to 2 pages; this is approx. 1300 words or 1000
words plus one figure)

Applications Notes are short descriptions of novel software or new
algorithm implementations, databases and network services (web
servers, and interfaces). Software or data must be freely available to
non-commercial users. Availability and Implementation must be clearly
stated in the article. Authors must also ensure that the software is
available for a full TWO YEARS following publication. Web services
must not require mandatory registration by the user. Additional
Supplementary data can be published online-only by the journal. This
supplementary material should be referred to in the abstract of the
Application Note. If describing software, the software should run
under nearly all conditions on a wide range of machines. Web servers
should not be browser specific. Application Notes must not describe
trivial utilities, nor involve significant investment of time for the
user to install. The name of the application should be included in the
title.



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


%\bibliography{Document}

%% \begin{thebibliography}{}
%% \bibitem[Bofelli {\it et~al}., 2000]{Boffelli03} Bofelli,F., Name2, Name3 (2003) Article title, {\it Journal Name}, {\bf 199}, 133-154.

%% \bibitem[Bag {\it et~al}., 2001]{Bag01} Bag,M., Name2, Name3 (2001) Article title, {\it Journal Name}, {\bf 99}, 33-54.

%% \bibitem[Yoo \textit{et~al}., 2003]{Yoo03}
%% Yoo,M.S. \textit{et~al}. (2003) Oxidative stress regulated genes
%% in nigral dopaminergic neurnol cell: correlation with the known
%% pathology in Parkinson's disease. \textit{Brain Res. Mol. Brain
%% Res.}, \textbf{110}(Suppl. 1), 76--84.

%% \bibitem[Lehmann, 1986]{Leh86}
%% Lehmann,E.L. (1986) Chapter title. \textit{Book Title}. Vol.~1, 2nd edn. Springer-Verlag, New York.

%% \bibitem[Crenshaw and Jones, 2003]{Cre03}
%% Crenshaw, B.,III, and Jones, W.B.,Jr (2003) The future of clinical
%% cancer management: one tumor, one chip. \textit{Bioinformatics},
%% doi:10.1093/bioinformatics/btn000.

%% \bibitem[Auhtor \textit{et~al}. (2000)]{Aut00}
%% Auhtor,A.B. \textit{et~al}. (2000) Chapter title. In Smith, A.C.
%% (ed.), \textit{Book Title}, 2nd edn. Publisher, Location, Vol. 1, pp.
%% ???--???.

%% \bibitem[Bardet, 1920]{Bar20}
%% Bardet, G. (1920) Sur un syndrome d'obesite infantile avec
%% polydactylie et retinite pigmentaire (contribution a l'etude des
%% formes cliniques de l'obesite hypophysaire). PhD Thesis, name of
%% institution, Paris, France.

%% \end{thebibliography}

%% \usepackage[margin=1in]{geometry}
%% \usepackage[dvips]{graphicx}
%% \usepackage[tight]{subfigure} 
%% %\usepackage{amsmath,amstext,color,colordvi,lscape,rotating,setspace,tabularx,natbib,url}
%% \usepackage{amsmath,amstext,color,colordvi,lscape,rotating,setspace,tabularx,url, multicol}

%% \newcommand{\captionfonts}{\small}
%% \renewcommand{\familydefault}{cmss}
%% \newcommand{\col}[2][red]{\textcolor{#1}{#2}}
%% \newcommand{\bi}{\begin{itemize}}
%% \newcommand{\ei}{\end{itemize}}
%% \newcommand{\package}{\emph{ReadSim}}
%% \newcommand{\compendium}{\emph{ReadSimCompendium}}
%% \newcommand{\rsem}{\emph{RSEM}}
%% \renewcommand{\bowtie}{\emph{bowtie}}
%% \newcommand{\ebseq}{\emph{EBSeq}}
%% \newcommand{\deseq}{\emph{DESeq2}}
%% \newcommand{\R}{\emph{R}}
%% \newcommand{\rnaseq}{RNA-seq}
%% \newcommand{\gi}{gene/isoform}
%% \newcommand{\gis}{genes/isoforms}
%% \newcommand{\pest}{\texttt{ParamEstimation}}
%% \newcommand{\csimu}{\texttt{CountSimu}}
%% \newcommand{\writeRSEM}{\texttt{writeRSEMFiles}}
%% \newcommand{\sgy}[1]{{\itshape\col{#1}}}
%% \newcommand{\XX}{\sgy{XX}}

%% \setlength{\parskip}{2ex plus0.5ex minus0.2ex} 
%% %\doublespacing
%% \parindent0em
%% \begin{document}
%% %\thispagestyle{empty}
%% \bigskip
%% \begin{center}
%%   {\LARGE \bf \package{}: an \R{} package for simulating reads in differential expression studies}
%% \\\vspace*{3em}
%% {\large Samuel G. Younkin$^1$, Ning Leng$^1$, Yuan Li$^1$, Christina Kendziorski$^1$}
%% \end{center}
%% \vspace*{2em}
%% \begin{minipage}[t]{\textwidth}
%%   \begin{itemize}
%%     \itemsep-0.5em
%%   \item[$^1$] Department of Biostatistics \& Medical Informatics
%%     University of Wisconsin{\textendash}Madison, Madison, WI USA
%%   \end{itemize}
%% \end{minipage}
%% * Author to whom correspondence should be addressed (kendzior@biostat.wisc.edu)
%% %\thispagestyle{empty}
%% \begin{multicols}{2}
%% {\large\textbf{Abstract}}\\ \textbf{Summary:} The package \package{}
%% is an \R{} package that simulates \rnaseq{} sequence reads, designed
%% for evaluation of differential expression (DE) analyses using
%% \rnaseq{} data.  It is built on the powerful and efficient software
%% package \rsem{}.  \package{} allows the user to generate simulated
%% reads and read-based count estimates within the \R{} environment.  The
%% number of reads, samples and set of differentially expressed
%% transcripts may be specified, as well as the reference sequences.  The
%% relationship between overall expression and fold-change is maintained
%% by fitting real data.\\ \textbf{Availability:} The source code and
%% data files for \package{} are privately available as an R package on
%% GitHub at
%% \url{https://github.com/syounkin/ReadSim}.\\
%% \textbf{Supplementary information:} A vignette accompanies the package which contains a
%% small demonstration of \package{}.  A larger analysis of chromosome 22
%% is available in the compendium package \compendium{}, found at
%% \url{http://www.biostat.wisc.edu/~syounkin/ReadSimPage.html}.
%% The source code for \rsem{} is publicly available on GitHub at
%% \url{https://github.com/bli25wisc/RSEM}.  The source code for
%% \bowtie{} is publicly available on GitHub at
%% \url{https://github.com/BenLangmead/bowtie}.\\
%% \textbf{Contact:} \texttt{kendzior@biostat.wisc.edu}\\\\
%% {\large{\textbf{Introduction}}}\\
%% RNA-seq is a powerful technology for measuring genome-wide
%% transcription, and dozens of statistical methods have been developed
%% recently to facilitate its use, including methods for estimating
%% expression and identifying differential expression (DE)
%% \cite{Oshlack2010}. The ability to evaluate these methods and compare
%% their performance in various settings is essential to ensure that
%% reliable information is obtained. The Microarray Quality Control
%% (MAQC) \cite{shi2006} data sets have proven useful toward this
%% end. However, they are limited by small sample sizes and
%% \XX{}. Evaluation of DE analysis methods can be performed with
%% simulated data, and a handful of methods to simulate RNA-seq reads
%% have been developed including FluxSimulator and BEERS
%% \cite{Griebel2012, Grant2011}.  BEERS is slow and, as with
%% FluxSimulator, does not allow specification of read count means and are
%% therefore not useful for DE-based read simulation.\\
%% We have developed \package{} to address these shortcomings. \package{}
%% is built on the software package \rsem{} used primarily
%% for transcript quantification \cite{li2011}.  \rsem{} includes a
%% highly efficient read simulator which can simulate one million reads
%% across around \emph{25,000} transcripts in approximately \emph{5} minutes.  We have developed the R package \package{} to perform
%% multiple runs of the \rsem{} simulator across samples and two
%% treatment groups.  To induce differential expression of transcripts
%% we adjust the relative transcript abundance across treatment groups in
%% an empirical model used by the \rsem{} simulator.\\
%% Transcript abundances vary substantially across \rnaseq{} experiments.
%% Factors such as cell type, organism, and various experimental
%% conditions affect the expected transcript abundances, isoform
%% distribution and so on.  For this reason \package{} builds its model
%% with sample data from an actual \rnaseq{} experiment.  The total
%% expression and fold change relationship for the simulated data is
%% modeled from these data. \package{} also takes advantage of the transcript
%% quantification provided by \rsem{} and allows the user to estimate
%% read counts from the simulated reads.  Both the read-based simulation
%% and differential expression analysis may be performed within \R{}
%% using any of the many \R{} packages available for DE analysis, e.g.,
%% DESeq2, EdgeR, EBSeq \cite{love2014, Robinson2010, leng2013}.  \package{}
%% empirically models the relationship between fold-change and expression
%% level given the sample data.  If fold-change is specified
%% independently from the expression level of the transcript, then
%% transcripts with high total expression may be assigned too large of a
%% fold change.\\\\
%% {\large\textbf{Method}}\\
%% {\small\package{} implements a two stage simulation.  First, it simulates
%% read counts per transcript under a negative binomial distribution
%% using empirical mean and dispersion estimates.  Second, it calculates
%% relative transcript abundance using estimates of transcript length and
%% read-count and updates the sample model and executes the \rsem{} read
%% simulator.\\
%% In the first step, read counts for the untreated group are
%% drawn from a negative binomial distribution with $\mu_0$,
%% $\varphi_0$. In the treated group differentially expressed transcripts
%% are simulated using $\mu_1 = \gamma\mu_0$, $\varphi_1=\varphi_0$.  The
%% parameter $\gamma$ is chosen to mimic the fold-change vs.\ total
%% expression relationship observed empirically, the \textit{MA
%%   signature}, see Figure \ref{ma-transcript}.\\
%% The MA signature is fit by binning the transcripts by
%% overall expression into $B$ bins, and the bin-wise standard deviation
%% for log fold-change is used to construct an appropriate interval for
%% the fold-change, from which a value is sampled randomly.  The interval
%% is defined as $I_{\textrm{bin}} = (k_1\sigma_{\textrm{bin}},
%% k_2\sigma_{\textrm{bin}})$, where $\sigma_{\textrm{bin}}$ is the
%% bin-wise standard deviation of log fold-change, and $k_1$ and $k_2$
%% are chosen by the user.  In the following chromosome 22 example,
%% values of $k_1=2$ and $k_2=4$ were used with $B=5$ bins.  By tuning
%% parameters $k_1$ and $k_2$ the user can control the signal strength of
%% the signal while preserving the relationship between fold-change and
%% total expression.\\
%% Three files are needed for \package{}; a transcript
%% template, the read-count estimates for all samples, and a sample model
%% file.  All of this are easily created using \rsem{} utilities. A GTF
%% file, transcript-to-gene file such as ``knownIsoforms.txt'' from the
%% UCSC Genome Browser, and a FASTA reference sequence, or a Multi-FASTA
%% file containing transcript sequences, may be used to create the
%% reference files.\\
%% In the second stage, the simulated read counts are used to
%% compute the relative transcript abundance needed for the read
%% simulation.  \package{} can return either the gene or isoform level
%% estimated read count from \rsem{}.  The software package \bowtie{} is
%% used for the alignment \cite{langmead2009}.
%% \\
%% \\
%% {\large\textbf{Chromosome 22 Example}}\\
%% We simulated 100,000 reads for each of eight samples from two
%% treatment groups, and we performed DE analysis of chromosome 22 using
%% \ebseq{} \cite{leng2013}.  One hundred genes (249 transcripts) were
%% selected at random, and each transcript was simulated to be
%% over-expressed.  We see in Figure \ref{ma-transcript} that the log
%% fold-change of the differentially expressed transcripts Figure
%% \ref{ma-transcript} (right) follows the MA signature we see in the
%% real data Figure \ref{ma-transcript} (left).\\
%% Using the gene- and transcript-wise estimated read counts from the
%% simulated data we performed DE analysis using \ebseq{}.  Of the 100
%% differentially expressed genes, 47 were correctly identified by
%% \ebseq{}, with five false discoveries ($\hat{\textrm{FDR}} = 0.1$), and 
%% of the 249 DE transcripts, 70 were correctly identified
%% ($\hat{\textrm{FDR}}=0.17$). Each time a posterior probability
%% threshold of 0.95 was used.\\
%% Unaligned read data from twenty RNA-seq chips, along with a set of
%% chromosome 22 reference files were used to simulate the reads in this
%% example.\\
%% The entire chromosome 22 example above took 18 minutes to
%% run and may be found in the compendium package \compendium{}, available at
%% \url{http://www.biostat.wisc.edu/~syounkin/}.
%% \\\\
%% {\large\textbf{Acknowledgments}}\\
%% SGY is supported by\ldots, NL, YL and CK\ldots
%% }
%% %\bibliographystyle{mypapers}
%% %\bibliographystyle{natbib}
%% \bibliographystyle{ieeetr}
%% {\small
%% \bibliography{myrefs}
%% }
%% \end{multicols}

%% \begin{figure}
%%   \begin{center}
%%     \includegraphics[width=0.4\textwidth]{./figures/fig1.png}
%%     \includegraphics[width=0.4\textwidth]{./figures/fig2.png}
%%     \caption{left: Estimated read counts from RNA-seq experiment;
%%       1,647 transcripts from chromosome 22; right: Simulated read counts,
%%       sd.range 2-4, 249 transcripts from 100 randomly selected genes
%%       across eight samples, all over-expressed, 5 bins }
%%     \label{ma-transcript}
%%   \end{center}
%% \end{figure}

%% \end{document}

%% %%   \rsem{} is not only an outstanding tool for estimating
%% %% the number of reads mapped to a set of \gis{}, but it also provides a
%% %% highly efficient read simulator.  \package{} serves as an R wrapper
%% %% for \rsem{} allowing the user to manipulate input files under a model
%% %% of differential expression.  


%% %% Because \rsem{} allows mapping at both the gene and isoform level,
%% %% \package{} may be used to simulate reads based on assumptions about
%% %% genes, or the underlying isoforms.  This is greatly advantageous and
%% %% currently the only read simulator that can do so.  

%% %% \newpage



%% %% \subsection{Data Input}

%% %% %%\newpage

%% %% \subsection{Read Simulation}

%% %% The primary purpose of \package{} is to simulate sequence reads in an
%% %% \rnaseq{} experiment to investigate the performance of methods
%% %% designed to identify genes that are differentially expressed across
%% %% treatement groups, e.g., \deseq{} and \ebseq{}.  Files that contain
%% %% estimated read counts from an experiment comprised of 10 untreated
%% %% subjects versus 10 treated subjects are provided with the pacakge.  If
%% %% the user has access to original \rnaseq{} data these data are
%% %% preferred.

%% %\subsection{Read Counts}

%% %% The function \pest{} estimates mean and dispersion parameters ($\mu_0$
%% %% and $\varphi_0$) for read counts per transcript, using the observed
%% %% estimated read counts in the untreated group.  The method of moments
%% %% estimators described in \cite{leng2013} are used when
%% %% $\hat{\mu_0}_{\textrm{MOM}} \le \hat{{\sigma_0}}^2_{\textrm{MOM}}$.
%% %% For the remaining transcipts a maximum likelihood approach is
%% %% implemented using unnormalized read counts. \emph{(Details on all zero
%% %%   transcripts and numerically unstable estimators\ldots ?)}

%% %% The function \csimu{} then simulates read counts for each subject and
%% %% transcript, given arguments that define which transcripts are
%% %% differentially expressed, and the extent of the differential
%% %% expression.


%% %% both microarray experiments and
%% %% modern \rnaseq{} experiments, see Section \ref{FC}.

%% %% \subsection{Relative Transcript Abundance}

%% %% Estimates of the transcript length along with estimated read counts
%% %% are used to estimate relative transcript abundances.

%% %% \subsection{\rsem{} Simulator}

%% %% Estimates of relative transcript abundance are used by the \rsem{}
%% %% simulator.  See the \emph{Implementation} section in \cite{li2011}.

%% %% \begin{quotation}
%% %% \emph{``RSEM additionally allows for the simulation of RNA-Seq data sets
%% %% according to the generative model on which it is based (see
%% %% Methods). Simulation is performed by the rsem-simulate-reads program,
%% %% which takes as input abundance estimates, sequencing model parameters,
%% %% and reference transcripts (as prepared by rsem-prepare-
%% %% reference). Typically, the abundance estimates and sequencing model
%% %% are obtained by running RSEM on a real data set, but they may also be
%% %% set manually.''}
%% %% \end{quotation}

%% %% Transcript abundances vary substantially across \rnaseq{} experiments.
%% %% Factors such as cell type, organism, and various experimental
%% %% conditions affect the expected trancript abundances, isoform
%% %% distribution and so on.  For this reason \package{} requires data from
%% %% a real \rnaseq{} experiment be used as input.  \package{} is built on
%% %% the exceptional software package \rsem{} which may be used to estimate
%% %% relative transcript abundances, as well as to simulate reads
%% %% \cite{li2011}.


%% %\newpage

%% %% \section{Outline}

%% %% \bi
%% %% \item Parameter Estimation
%% %%   \bi
%% %%     \item To incorporate between-experiment variation, \package{} simulates RNA-seq reads using real data.  The input files needed for \package{} are obtained by first running \rsem{} using all of the available unaligned reads obtained from the original RNA-seq experiment.  Read counts for each \gi{} are assumed to be distributed under a negative binomial distribution and the estimated read counts from the untreated samples are used to estimate the mean and dispersion parameters for each \gi{} listed in the reference file.  
%% %%     \item Method of moment estimators, as described in \cite{leng2013}, are used to estimate parameters for all \gis{} with $\hat{\mu}_{\textrm{MOM}} \le \hat{{\sigma}}^2_{\textrm{MOM}}$.  For \gis{} with $\hat{\mu}_{\textrm{MOM}} > \hat{{\sigma}}^2_{\textrm{MOM}}$ we use maximum likelihood methods. (Note that we do not normalize read counts when using maximum likelihood.)
%% %%   \ei
%% %% \item Selection of DE \gis{}
%% %%   \bi
%% %%     \item \package{} provides a function to identify the set of genes that have at least $n$ isoforms with expected count greater than the $(1-\alpha)^{\textrm{th}}$ quantile.  This allows a convenient way to simulate reads from genes with differential expression while ensuring that there are multiple highly expressed isoforms present.  (It would be nice to be able to identify genes that are highly expressed, regardless of the isoform structure.  Setting $n=1$ gets the user close, but is not exactly the same.)
%% %%   \ei      
%% %% \item Assignment of Fold-change
%% %%   \bi
%% %%     \item \package{} uses the real data provided by the user to model the relationship between fold-change and expression level seen in data.  The \gis{} are binned into $B$ bins and the bin-wise standard deviation for fold-change is used to construct an appropriate interval for the fold-change of \gis{} that will be simulated as differentially expressed.  This interval is defined in terms of the bin-wise standard deviation as $I_{\textrm{bin}} = (k_1\sigma_{\textrm{bin}}, k_2\sigma_{\textrm{bin}})$, where $k_1$ and $k_2$ are chosen by the user.  In the data included with \package{} values of $k_1=3$ and $k_2=4$ were used.
%% %%     \item Expected read counts for differentially expressed \gis{} in the treated group are randomly drawn from a negative binomial distribution with $\mu = \gamma\mu_0$, and $\varphi = \varphi_0$, where $\mu_0$, $\varphi_0$ are the mean and dispersion parameters per \gi{} in the untreated group, and $\gamma$ is the fold-change.
%% %%     \item These expected read counts are then used to compute the relative abundance of each \gi{}, which is then used, along with a reference panel and sample model file, by \rsem{} to simulate reads.
%% %%     \item A simulation for a study 10 vs. 10 subjects for $x$ genes at a read depth of 1 million takes $x$ minutes.
%% %%   \ei
%% %% \item Read-count Estimation and Downstream DE Analysis
%% %%   \bi
%% %%     \item If the simulated estimated read count per \gi{} is desired, setting \texttt{findExpression = TRUE} causes a matrix of expected read counts to be returned.  This matrix is well-suited for down-stream analysis by \R{} packages such as \ebseq{} and \deseq{}
%% %%     \item Performing the read count estimation requires an additional $x$ minutes per subject.
%% %%     \item (It took four hours for me to simulate 1 million reads 10 by 10 and perform both EBSeq and DESeq analyses.
%% %%     \item {\small \texttt{http://www.biostat.wisc.edu/\~{}kendzior/CKGROUP/YOUNKIN/TwoHighlyExpressedIsoforms.html}}
%% %%     \ei
%% %% \item Calibration
%% %%   \bi
%% %%     \item Demonstrate the distribution of parameters in the simulated read data
%% %%     \item Demonstrate the ability of \deseq{} and \ebseq to identify DE genes
%% %%   \ei
%% %% \item Discussion
%% %%   \bi
%% %%     \item Advantage of simulation on the isoform level
%% %%     \item Compare computation times with \emph{BEERS}
%% %%     \item Discuss \emph{FLUX} and \emph{Polyester}
%% %%     \item Discuss ability to address depth vs.\ sample size issue
%% %%   \ei
%% %% \item Input Files
%% %%   \bi
%% %%   \item Three files, along with a set of genome reference files, are needed to perform the simulation.  All of these files are easily constructed with \rsem{}.
%% %%   \bi
%% %%   \item \texttt{template.genes.results} or \texttt{template.isoforms.results}
%% %%     \bi
%% %%       \item \rsem{} output from one chip
%% %%       \item Used as a template for creating \rsem{} simulator input files and for length data
%% %%     \ei
%% %%   \item \texttt{*.model}
%% %%     \bi
%% %%       \item \rsem{} output from one chip
%% %%       \item Used for \rsem{} simulator
%% %%     \ei
%% %%   \item \texttt{count.genes.matrix} or \texttt{count.isoforms.matrix}
%% %%     \bi
%% %%       \item Used to estimate mean and dispersion parameters
%% %%     \ei
%% %%   \item \texttt{NM\_refseq\_ref\_gene.*} or \texttt{NM\_refseq\_ref\_isoform.*}
%% %%     \bi
%% %%       \item reference files created by \rsem{}
%% %%     \ei
%% %%   \ei
%% %%   \ei
%% %% \ei
